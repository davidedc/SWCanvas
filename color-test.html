<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Consistency Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .canvas-container {
            display: inline-block;
            text-align: center;
            margin: 10px;
        }
        .canvas-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .test-canvas {
            border: 2px solid #ccc;
            margin: 10px;
        }
        .results {
            font-family: monospace;
            font-size: 12px;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Color Consistency Test</h1>
    
    <div class="test-section">
        <h2>Green Color Comparison</h2>
        <p>Testing CSS 'green' vs SWCanvas rgb(0,128,0) consistency:</p>
        
        <div class="canvas-container">
            <div class="canvas-label">HTML5 Canvas</div>
            <canvas id="html5-canvas" width="100" height="100" class="test-canvas"></canvas>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-label">SWCanvas</div>
            <canvas id="swcanvas-result" width="100" height="100" class="test-canvas"></canvas>
        </div>
        
        <button onclick="runColorTest()">Run Color Test</button>
        <div id="test-results" class="results"></div>
    </div>

    <script src="dist/swcanvas.js"></script>
    <script>
        function runColorTest() {
            const html5Canvas = document.getElementById('html5-canvas');
            const swCanvas = document.getElementById('swcanvas-result');
            const results = document.getElementById('test-results');
            
            // HTML5 Canvas - draw with CSS 'green'
            const html5Ctx = html5Canvas.getContext('2d');
            html5Ctx.fillStyle = 'white';
            html5Ctx.fillRect(0, 0, 100, 100);
            html5Ctx.fillStyle = 'green';
            html5Ctx.fillRect(25, 25, 50, 50);
            
            // SWCanvas - draw with rgb(0,128,0)
            const surface = SWCanvas.Surface(100, 100);
            const ctx = new SWCanvas.Context2D(surface);
            ctx.setFillStyle(255, 255, 255, 255);
            ctx.fillRect(0, 0, 100, 100);
            ctx.setFillStyle(0, 128, 0, 255);
            ctx.fillRect(25, 25, 50, 50);
            
            // Render SWCanvas to display canvas
            const displayCtx = swCanvas.getContext('2d');
            const imageData = displayCtx.createImageData(100, 100);
            
            // Copy SWCanvas data (un-premultiply for display)
            for (let i = 0; i < surface.data.length; i += 4) {
                const r = surface.data[i];
                const g = surface.data[i + 1];
                const b = surface.data[i + 2];
                const a = surface.data[i + 3];
                
                imageData.data[i] = r;
                imageData.data[i + 1] = g;
                imageData.data[i + 2] = b;
                imageData.data[i + 3] = a;
            }
            displayCtx.putImageData(imageData, 0, 0);
            
            // Compare pixel values at center of green squares
            const html5ImageData = html5Ctx.getImageData(50, 50, 1, 1);
            const html5Pixel = html5ImageData.data;
            
            const swPixelOffset = (50 * surface.stride) + (50 * 4);
            const swPixel = [
                surface.data[swPixelOffset],
                surface.data[swPixelOffset + 1],
                surface.data[swPixelOffset + 2],
                surface.data[swPixelOffset + 3]
            ];
            
            // Display results
            results.innerHTML = `
<strong>Color Comparison Results:</strong>
HTML5 Canvas 'green' pixel: rgb(${html5Pixel[0]}, ${html5Pixel[1]}, ${html5Pixel[2]}, ${html5Pixel[3]})
SWCanvas rgb(0,128,0) pixel:  rgb(${swPixel[0]}, ${swPixel[1]}, ${swPixel[2]}, ${swPixel[3]})

<strong>Match Status:</strong>
Red:   ${html5Pixel[0] === swPixel[0] ? '‚úÖ MATCH' : '‚ùå MISMATCH'} (${html5Pixel[0]} vs ${swPixel[0]})
Green: ${html5Pixel[1] === swPixel[1] ? '‚úÖ MATCH' : '‚ùå MISMATCH'} (${html5Pixel[1]} vs ${swPixel[1]})
Blue:  ${html5Pixel[2] === swPixel[2] ? '‚úÖ MATCH' : '‚ùå MISMATCH'} (${html5Pixel[2]} vs ${swPixel[2]})
Alpha: ${html5Pixel[3] === swPixel[3] ? '‚úÖ MATCH' : '‚ùå MISMATCH'} (${html5Pixel[3]} vs ${swPixel[3]})

<strong>Overall:</strong> ${
    html5Pixel[0] === swPixel[0] && 
    html5Pixel[1] === swPixel[1] && 
    html5Pixel[2] === swPixel[2] && 
    html5Pixel[3] === swPixel[3] ? 
    'üéâ PERFECT COLOR MATCH!' : 
    '‚ö†Ô∏è Color differences detected'
}
            `;
        }
        
        // Auto-run test on page load
        window.onload = runColorTest;
    </script>
</body>
</html>